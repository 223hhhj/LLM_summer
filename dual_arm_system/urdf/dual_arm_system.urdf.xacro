<?xml version="1.0"?>
<robot xmlns:xacro="http://wiki.ros.org/xacro" name="dual_arm_system">

  <!-- 包含必要的宏定義 -->
  <xacro:include filename="$(find ur_description)/urdf/ur_macro.xacro"/>
  <xacro:include filename="$(find arm0718_description)/urdf/arm0718_macro.xacro"/>

  <!-- 材質定義 -->
  <material name="white">
    <color rgba="1.0 1.0 1.0 1.0"/>
  </material>
  
  <material name="grey">
    <color rgba="0.5 0.5 0.5 1.0"/>
  </material>

  <!-- 世界基座 -->
  <link name="world"/>

  <!-- 共用工作檯面 -->
  <link name="work_table">
    <visual>
      <geometry>
        <box size="2.0 1.5 0.05"/>
      </geometry>
      <material name="white"/>
    </visual>
    <collision>
      <geometry>
        <box size="2.0 1.5 0.05"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="20.0"/>
      <inertia ixx="6.25" ixy="0.0" ixz="0.0" 
               iyy="8.33" iyz="0.0" izz="14.58"/>
    </inertial>
  </link>

  <joint name="world_to_table" type="fixed">
    <parent link="world"/>
    <child link="work_table"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <!-- 左臂基座支撐 -->
  <link name="left_arm_base">
    <visual>
      <geometry>
        <box size="0.2 0.2 0.8"/>
      </geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <geometry>
        <box size="0.2 0.2 0.8"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="10.0"/>
      <inertia ixx="0.54" ixy="0.0" ixz="0.0" 
               iyy="0.54" iyz="0.0" izz="0.07"/>
    </inertial>
  </link>

  <joint name="table_to_left_base" type="fixed">
    <parent link="work_table"/>
    <child link="left_arm_base"/>
    <origin xyz="-0.6 0.4 0.425" rpy="0 0 0"/>
  </joint>

  <!-- 右臂基座支撐 -->
  <link name="right_arm_base">
    <visual>
      <geometry>
        <box size="0.2 0.2 0.8"/>
      </geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <geometry>
        <box size="0.2 0.2 0.8"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="10.0"/>
      <inertia ixx="0.54" ixy="0.0" ixz="0.0" 
               iyy="0.54" iyz="0.0" izz="0.07"/>
    </inertial>
  </link>

  <joint name="table_to_right_base" type="fixed">
    <parent link="work_table"/>
    <child link="right_arm_base"/>
    <origin xyz="0.6 0.4 0.425" rpy="0 0 3.14159"/>
  </joint>

  <!-- 左臂 - UR5 -->
  <xacro:ur_robot 
    name="left_arm"
    tf_prefix="left_"
    parent="left_arm_base"
    joint_limits_parameters_file="$(find ur_description)/config/ur5/joint_limits.yaml"
    kinematics_parameters_file="$(find ur_description)/config/ur5/default_kinematics.yaml"
    physical_parameters_file="$(find ur_description)/config/ur5/physical_parameters.yaml"
    visual_parameters_file="$(find ur_description)/config/ur5/visual_parameters.yaml">
    <origin xyz="0 0 0.4" rpy="0 0 0"/>
  </xacro:ur_robot>

  <!-- 右臂 - arm0718 -->
  <xacro:arm0718_robot 
    name="right_arm"
    tf_prefix="right_"
    parent="right_arm_base">
    <origin xyz="0 0 0.4" rpy="0 0 0"/>
  </xacro:arm0718_robot>

  <!-- 共用物體：可移動的工作物件 -->
  <link name="workpiece_1">
    <visual>
      <geometry>
        <cylinder radius="0.03" length="0.1"/>
      </geometry>
      <material name="red">
        <color rgba="1.0 0.0 0.0 0.8"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.03" length="0.1"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.2"/>
      <inertia ixx="0.0002" ixy="0.0" ixz="0.0" 
               iyy="0.0002" iyz="0.0" izz="0.00009"/>
    </inertial>
  </link>

  <joint name="table_to_workpiece1" type="fixed">
    <parent link="work_table"/>
    <child link="workpiece_1"/>
    <origin xyz="0 0 0.075" rpy="0 0 0"/>
  </joint>

</robot>